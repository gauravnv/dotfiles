# Enable Powerlevel10k instant prompt (must be at top)
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Path to your oh-my-zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# Path to nvim
export PATH="$PATH:/opt/nvim-linux-x86_64/bin"

# Rust toolchain (for cargo-installed tools like `delta`)
case ":$PATH:" in
  *":$HOME/.cargo/bin:"*) ;;
  *) export PATH="$HOME/.cargo/bin:$PATH" ;;
esac

# Use Powerlevel10k theme
ZSH_THEME="powerlevel10k/powerlevel10k"

# Plugins - syntax-highlighting must be last
plugins=(
    git
    zsh-autosuggestions
    zsh-completions
    zsh-syntax-highlighting
)

# Initialize completions
fpath+=${ZSH_CUSTOM:-${ZSH:-~/.oh-my-zsh}/custom}/plugins/zsh-completions/src

source $ZSH/oh-my-zsh.sh

# User configuration

# History settings
HISTSIZE=50000
SAVEHIST=50000
setopt HIST_IGNORE_ALL_DUPS  # Don't record duplicates
setopt HIST_FIND_NO_DUPS     # Don't show duplicates when searching
setopt SHARE_HISTORY         # Share history between sessions

# Better directory navigation
setopt AUTO_CD               # Type directory name to cd into it
setopt AUTO_PUSHD            # Make cd push old directory onto stack
setopt PUSHD_IGNORE_DUPS     # Don't push duplicates
setopt CDABLE_VARS           # cd into variable values

# Completion settings
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'  # Case insensitive

# Useful aliases
if command -v eza >/dev/null 2>&1; then
  alias ls='eza --icons --group-directories-first'
  alias ll='eza -lah --icons --group-directories-first'
  alias la='eza -a --icons --group-directories-first'
  alias l='eza --icons --group-directories-first'
else
  alias ll='ls -alh --color=auto'
  alias la='ls -A --color=auto'
  alias l='ls -CF --color=auto'
fi

alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
# alias grep='grep --color=auto'  # Replaced by ripgrep below
alias grep='rg'
alias cat='batcat --paging=never 2>/dev/null || cat'
alias update='sudo apt update && sudo apt upgrade'
alias please='sudo $(fc -ln -1)'  # Re-run last command with sudo

# Git aliases
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git pull'
alias gd='git diff'
alias gco='git checkout'
alias gcb='git checkout -b'
alias gcm='git commit -m'
alias gb='git branch'
alias glog='git log --oneline --graph --decorate'

# ASUS ROG shortcuts
alias gpu-status='supergfxctl --get'
alias gpu-hybrid='supergfxctl --mode Hybrid && echo "Logout required"'
alias gpu-integrated='supergfxctl --mode Integrated && echo "Logout required"'
alias profile='asusctl profile -p'
alias rog='rog-control-center'

# Development
alias py='python3'
alias pip='pip3'
alias dc='docker compose'
alias k='kubectl'

# GitHub CLI
alias ghpr='gh pr create'
alias ghpv='gh pr view --web'

# tmux shortcuts
alias tn='tmux new -s'
alias ta='tmux attach -t'
alias tl='tmux list-sessions'

# uv (Python)
alias uvr='uv run'
alias uvs='uv sync'
alias uva='uv add'

# System tools (the new ones you installed)
alias top='btop'                          # Better system monitor
alias du='ncdu'                           # Interactive disk usage
alias help='tldr'                         # Simplified man pages
alias cat='batcat --paging=never'         # Syntax highlighted cat
alias find='fdfind'                       # Faster find
alias rm='trash-put'                      # Safe delete (moves to trash)
alias rmi='/bin/rm -i'                    # Real rm with confirmation

# fzf integration for powerful fuzzy finding
alias fzp='fzf --preview "batcat --color=always --style=numbers --line-range=:500 {}"'
alias fcd='cd $(find . -type d 2>/dev/null | fzf)'  # Fuzzy cd into directory
alias fopen='xdg-open "$(fzf)"'           # Fuzzy find and open file

# Quick system tools
alias disk='ncdu /'                       # Analyze full disk
alias ports='ss -tulpn'                   # Show open ports
alias mem='free -h'                       # Memory usage
alias cpu='btop --utf-force'              # CPU monitor

# Color output
export LESS='-R'
if diff --help 2>/dev/null | command grep -q -- '--color'; then
  alias diff='diff --color=auto'
fi
if ip -h 2>/dev/null | command grep -Eq -- ' -c\b|--color'; then
  alias ip='ip -c'
fi
if command -v tree >/dev/null 2>&1; then
  alias tree='tree -C'
fi

# Better git diffs (delta)
if command -v delta >/dev/null 2>&1; then
  export GIT_PAGER='delta'
fi

alias ff='fastfetch'

# Load Powerlevel10k config if it exists
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# fzf keybindings (Ctrl+R for history, Ctrl+T for files, Alt+C for cd)
[ -f /usr/share/doc/fzf/examples/key-bindings.zsh ] && source /usr/share/doc/fzf/examples/key-bindings.zsh
[ -f /usr/share/doc/fzf/examples/completion.zsh ] && source /usr/share/doc/fzf/examples/completion.zsh

# Disable bracketed paste mode for VSCode terminal
unset zle_bracketed_paste

# fnm
FNM_PATH="$HOME/.local/share/fnm"
if [ -d "$FNM_PATH" ]; then
  export PATH="$FNM_PATH:$PATH"
  eval "`fnm env`"
fi

# zoxide (smarter cd)
if command -v zoxide >/dev/null 2>&1; then
  eval "$(zoxide init zsh)"
fi

# direnv (per-project env vars)
if command -v direnv >/dev/null 2>&1; then
  eval "$(direnv hook zsh)"
fi

# ═══════════════════════════════════════════════════════════════
# Shortcut & Alias Reference
# ═══════════════════════════════════════════════════════════════

# Ensure local scripts are available (includes `shortcut-ref`).
case ":$PATH:" in
  *":$HOME/.local/bin:"*) ;;
  *) export PATH="$HOME/.local/bin:$PATH" ;;
esac

# Prefer the installed script over a shell function.
alias shortcuts="$HOME/.local/bin/shortcut-ref"

# opencode
export PATH=$HOME/.opencode/bin:$PATH
