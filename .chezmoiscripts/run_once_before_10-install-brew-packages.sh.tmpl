#!/usr/bin/env bash
set -euo pipefail

# Install baseline packages on macOS via Homebrew.
{{ if ne .chezmoi.os "darwin" -}}
exit 0
{{ end -}}

if ! command -v brew >/dev/null 2>&1; then
  echo "chezmoi: installing Homebrew..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  eval "$(/opt/homebrew/bin/brew shellenv)"
fi

brewfile="{{ joinPath .chezmoi.sourceDir "Brewfile" }}"

if [ ! -f "$brewfile" ]; then
  echo "chezmoi: missing $brewfile" >&2
  exit 1
fi

echo "chezmoi: installing packages from Brewfile..."
brew bundle --file="$brewfile" --no-lock
